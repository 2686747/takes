<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_75) on Sun May 10 03:46:00 UTC 2015 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>org.takes.facets.flash (take 0.16.7 API)</title>
<meta name="date" content="2015-05-10">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="org.takes.facets.flash (take 0.16.7 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/takes/facets/fallback/package-summary.html">Prev Package</a></li>
<li><a href="../../../../org/takes/facets/fork/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/takes/facets/flash/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.takes.facets.flash</h1>
<div class="docSummary">
<div class="block">Flash messages.</div>
</div>
<p>See:&nbsp;<a href="#package_description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/takes/facets/flash/RsFlash.html" title="class in org.takes.facets.flash">RsFlash</a></td>
<td class="colLast">
<div class="block">Forwarding response.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/takes/facets/flash/TkFlash.html" title="class in org.takes.facets.flash">TkFlash</a></td>
<td class="colLast">
<div class="block">Take that understands Flash cookie and converts it into a HTTP header.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/takes/facets/flash/XeFlash.html" title="class in org.takes.facets.flash">XeFlash</a></td>
<td class="colLast">
<div class="block">Xembly source to show flash message in XML.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package_description">
<!--   -->
</a>
<h2 title="Package org.takes.facets.flash Description">Package org.takes.facets.flash Description</h2>
<div class="block">Flash messages.

 <p>Flash messages is a useful technique that allows us to send short
 texts from one web page to another without any persistence on the server.
 Here is how it works. A web page performs some operation, for example
 making a post to a discussion thread. Then, the page returns a HTTP response
 with a redirection status 303. The response contains a "Set-Cookie" HTTP
 header with a flash message "thanks for the post".

 <p>The browser preserves the cookie
 and redirects to the page with the discussion thread. The browser makes
 a new HTTP request, to render the content of the discussion thread. This
 HTTP GET request contains a "Cookie" HTTP header with that message
 "thanks for the post". The server adds this message to the HTML page,
 informing the user about the action just completed, and returns a HTTP
 response. This response contains a "Set-Cookie" HTTP header with an empty
 value, which is a signal for the browser to remove the cookie.

 <p>The browser won't send the flash message twice, because it is deleted
 after the first time it was rendered in HTML by the server. The deletion
 is controlled by the server, when it returns an HTTP response with
 "Set-Cookie" header with an empty value.

 <p>Classes in this package helps to automate this mechanism. First,
 you add flash messages to your responses using
 <a href="../../../../org/takes/facets/flash/RsFlash.html" title="class in org.takes.facets.flash"><code>RsFlash</code></a>:

 <pre>public final class TkDiscussion implements Take {
   &#64;Override
   public Response act(final Request req) {
     // save the post to the database
     return new RsFlash(
       new RsForward(),
       "thanks for the post"
     );
   }
 }</pre>

 <p>This <a href="../../../../org/takes/facets/flash/RsFlash.html" title="class in org.takes.facets.flash"><code>RsFlash</code></a> decorator will add the
 required "Set-Cookie" header to the response. This is all it is doing.
 The response is added to the cookie in URL-encoded format, together
 with the logging level. Flash messages could be of different severity,
 we're using Java logging levels for that, for example:

 <pre>public final class TkDiscussion implements Take {
   &#64;Override
   public Response act(final Request req) {
     if (failed) {
       throw new RsFlash(
         new RsForward(),
         "can't save your post, sorry",
         java.util.logging.Level.SEVERE
       );
     }
   }
 }</pre>

 <p>This is how the HTTP response will look like (simplified):

 <pre> HTTP/1.1 303 See Other
 Set-Cookie: RsFlash=can%27t%20save%20your%20post%2C%20sorry/SEVERE</pre>

 <p>Here, the name of the cookie is <code>RsFlash</code>. You can change this
 default name using a constructor of <a href="../../../../org/takes/facets/flash/RsFlash.html" title="class in org.takes.facets.flash"><code>RsFlash</code></a>,
 but it's not recommended. It's better to use the default name.

 <p>The next step is to understand that cookie on its way back,
 from the browser to the server. This is what a browser will send back:

 <pre> GET / HTTP/1.1
 Host: www.example.com
 Cookie: RsFlash=can%27t%20save%20your%20post%2C%20sorry/SEVERE</pre>

 <p>There is a class <a href="../../../../org/takes/facets/flash/TkFlash.html" title="class in org.takes.facets.flash"><code>TkFlash</code></a>, that
 decorates your existing "take" and adds "Set-Cookie" with an empty
 value to the response. That's all it's doing. All you need to do
 is to decorate your existing "take", for example:

 <pre> new FtBasic(
   new TkFlash(TkFork(new FkRegex("/", "hello, world!"))), 8080
  ).start(Exit.NEVER);
 }</pre>

 <p>The last step is to fetch that cookie from the request and add
 to the HTML page. You can use <a href="../../../../org/takes/rq/RqCookies.html" title="interface in org.takes.rq"><code>RqCookies</code></a> for that
 (it's a pseudo-code, don't build HTML like this!):

 <pre>public final class TkDiscussion implements Take {
   &#64;Override
   public Response act(final Request req) {
     String html = "this is our discussion thread...";
     final Iterator&lt;String&gt; cookies =
       new RqCookies(req).cookie("RsFlash").iterator();
       if (cookies.hasNext()) {
         html = cookies.next() + html;
       }
       return new RsHTML(html);
     }
   }
 }</pre>

 <p>If you're using Xembly to build XML output, you can use
 <a href="../../../../org/takes/facets/flash/XeFlash.html" title="class in org.takes.facets.flash"><code>XeFlash</code></a> for fetching flash messages
 from cookies and adding them to XML:

 <pre>public final class TkDiscussion implements Take {
   private final Request req;
   &#64;Override
   public Response act(final Request req) {
     return new RsXembly(
       new XeAppend(
         "page",
         new XeFlash(req),
         // your other Xembly sources
       )
     );
   }
 }</pre>

 <p>Don't forget that the cookie you receive is not just a flash message,
 but also other parameters, URL-encoded and separated by "slash".</p></div>
<dl><dt><span class="strong">Since:</span></dt>
  <dd>0.1</dd>
<dt><span class="strong">Version:</span></dt>
  <dd>$Id$</dd>
<dt><span class="strong">Author:</span></dt>
  <dd>Yegor Bugayenko (yegor@teamed.io)</dd></dl>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/takes/facets/fallback/package-summary.html">Prev Package</a></li>
<li><a href="../../../../org/takes/facets/fork/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/takes/facets/flash/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2015 <a href="https://github.com/yegor256/takes">Take</a>. All rights reserved.</small></p>
</body>
</html>
